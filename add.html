<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CardFlow — Add Cards</title>
  <link rel="stylesheet" href="./css/styles.css" />
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <header class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true">CF</div>
      <div class="brand-text">
        <div class="brand-title">CardFlow</div>
        <div class="brand-sub">Add Cards</div>
      </div>
    </div>

    <nav class="top-actions" aria-label="Primary">
      <a class="btn btn-primary" href="./add.html" aria-current="page">Add Cards</a>
      <a class="btn btn-ghost" href="./index.html">Home</a>

      <div class="theme-toggle" role="group" aria-label="Theme">
        <span class="theme-label">Neon</span>
        <label class="switch" aria-label="Toggle theme">
          <input id="themeSwitch" type="checkbox" />
          <span class="slider" aria-hidden="true"></span>
        </label>
        <span class="theme-label">Fantasy</span>
      </div>
    </nav>
  </header>

  <main id="main" class="container">
    <section class="panel">
      <h1 class="h1">Add a card</h1>

      <form id="cardForm" class="form" novalidate>
        <div class="grid-2">
          <div class="field">
            <label for="binderSelect">Binder <span aria-hidden="true">*</span></label>
            <select id="binderSelect" required></select>
            <p class="error" id="binderError" aria-live="polite"></p>
          </div>

          <div class="field">
            <label for="newBinderName">Or create binder</label>
            <div class="inline">
              <input id="newBinderName" type="text" placeholder="New binder name" />
              <button class="btn btn-small" id="createBinderBtn" type="button">Create</button>
            </div>
          </div>

          <div class="field">
            <label for="gameSelect">Game <span aria-hidden="true">*</span></label>
            <select id="gameSelect" required>
              <option value="pokemon">Pokémon</option>
              <option value="mtg">Magic: The Gathering</option>
            </select>
          </div>

          <div class="field">
            <label for="rarity">Rarity <span aria-hidden="true">*</span></label>
            <select id="rarity" required>
              <option value="">Select rarity…</option>
              <option value="common">Common</option>
              <option value="uncommon">Uncommon</option>
              <option value="rare">Rare</option>
              <option value="holo">Holo</option>
              <option value="ultra">Ultra Rare</option>
              <option value="secret">Secret Rare</option>
            </select>
            <p class="hint">Sleeve animation changes based on rarity.</p>
          </div>

          <div class="field grid-span-2">
            <label for="setSelect">Series / Expansion (local database) <span aria-hidden="true">*</span></label>
            <select id="setSelect" required>
              <option value="">Loading sets…</option>
            </select>
            <p class="error" id="setError" aria-live="polite"></p>
          </div>
        </div>

        <hr class="sep" />

        <!-- Image capture/upload + scan UI -->
        <section class="panel soft">
          <h2 class="h2">Card image</h2>
          <div class="grid-2">
            <div class="field">
              <label for="cardImage">Upload or scan (phone camera)</label>
              <input id="cardImage" type="file" accept="image/*" capture="environment" />
              <div class="inline" style="margin-top:10px; gap:10px; flex-wrap:wrap;">
                <button class="btn btn-small" id="startScanBtn" type="button">Start Scan</button>
                <button class="btn btn-small btn-ghost" id="captureBtn" type="button" disabled>Capture</button>
                <button class="btn btn-small btn-ghost" id="useScanBtn" type="button" disabled>Use Scanned Image</button>
                <button class="btn btn-small" id="autoFillBtn" type="button">Auto-Fill From Image</button>
                <button class="btn btn-small btn-ghost" id="stopScanBtn" type="button" disabled>Stop</button>
              </div>
              <p class="hint">Local-only scan: camera → edge detect → crop. Works best in good lighting.</p>
            </div>

            <div class="preview" aria-label="Scan preview">
              <video id="scanVideo" playsinline class="hidden" style="width:100%; border-radius:14px;"></video>
              <canvas id="scanCanvas" class="hidden" style="width:100%; border-radius:14px;"></canvas>
              <img id="imagePreview" alt="Selected card preview" src="./assets/placeholder-card.png" />
            </div>
          </div>

          <!-- Load OpenCV locally -->
          <script src="./vendor/opencv/opencv.js"></script>
          <!-- Load Tesseract locally (for OCR) -->
          <script src="./vendor/tesseract/tesseract.min.js"></script>
        </section>

        <hr class="sep" />

        <!-- Pokémon fields -->
        <section id="pokemonFields" class="panel soft" aria-label="Pokémon card fields">
          <h2 class="h2">Pokémon card details</h2>

          <div class="grid-2">
            <div class="field">
              <label for="p_name">Name <span aria-hidden="true">*</span></label>
              <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
                <input id="p_search" placeholder="Search Pokémon name, number or set+number (e.g. SV1 12)" style="flex:1;" />
                <button class="btn btn-small" id="p_searchBtn" type="button">Search</button>
              </div>
              <div id="p_searchResults" style="margin-top:8px; display:none; background:#111; border-radius:8px; padding:8px;">
                <!-- Search results inserted here -->
              </div>
              <input id="p_name" name="p_name" required />
              <p class="error" data-for="p_name" aria-live="polite"></p>
            </div>

            <div class="field">
              <label for="p_hp">HP</label>
              <input id="p_hp" name="p_hp" inputmode="numeric" pattern="^[0-9]{1,4}$" placeholder="e.g., 120" />
              <p class="hint">Numbers only.</p>
            </div>

            <div class="field">
              <label for="p_type">Type / Energy</label>
              <select id="p_type" name="p_type"></select>
            </div>

            <div class="field">
              <label for="p_evoStage">Evolution Stage</label>
              <input id="p_evoStage" name="p_evoStage" placeholder="Basic / Stage 1 / Stage 2 / V / ex…" />
            </div>

            <div class="field">
              <label for="p_evolvesFrom">Evolves From</label>
              <input id="p_evolvesFrom" name="p_evolvesFrom" placeholder="If applicable" />
            </div>

            <div class="field">
              <label for="p_ability">Ability</label>
              <input id="p_ability" name="p_ability" placeholder="If applicable" />
            </div>

            <div class="field grid-span-2">
              <label for="p_attacks">Attacks</label>
              <textarea id="p_attacks" name="p_attacks" rows="3" placeholder="List attacks + damage + costs…"></textarea>
            </div>

            <div class="field">
              <label for="p_weakness">Weakness</label>
              <input id="p_weakness" name="p_weakness" />
            </div>

            <div class="field">
              <label for="p_resistance">Resistance</label>
              <input id="p_resistance" name="p_resistance" placeholder="If applicable" />
            </div>

            <div class="field">
              <label for="p_retreat">Retreat Cost</label>
              <input id="p_retreat" name="p_retreat" placeholder="e.g., ◇◇" />
            </div>

            <div class="field grid-span-2">
              <label for="p_flavor">Pokédex / Flavor Text</label>
              <textarea id="p_flavor" name="p_flavor" rows="2"></textarea>
            </div>

            <div class="field">
              <label for="p_cardNumber">Card Number</label>
              <input id="p_cardNumber" name="p_cardNumber" placeholder="e.g., 12/198" />
            </div>

            <div class="field">
              <label for="p_setSymbol">Set Symbol</label>
              <select id="p_setSymbol"></select>
            </div>

            <div class="field">
              <label for="p_raritySymbol">Rarity Symbol</label>
              <select id="p_raritySymbol"></select>
            </div>

            <div class="field">
              <label for="p_regMark">Regulation Mark</label>
              <input id="p_regMark" name="p_regMark" placeholder="e.g., H, G, F…" />
            </div>

            <div class="field">
              <label for="p_illustrator">Illustrator</label>
              <input id="p_illustrator" name="p_illustrator" />
            </div>

            <div class="field grid-span-2">
              <label for="p_backNotes">Back of the card notes</label>
              <textarea id="p_backNotes" name="p_backNotes" rows="2"
                placeholder="Pokémon logo / Poké Ball design (stored as notes)"></textarea>
            </div>
          </div>
        </section>

        <!-- MTG fields -->
        <section id="mtgFields" class="panel soft hidden" aria-label="Magic: The Gathering card fields">
          <h2 class="h2">Magic: The Gathering card details</h2>

          <div class="grid-2">
            <div class="field">
              <label for="m_name">Name <span aria-hidden="true">*</span></label>
              <input id="m_name" name="m_name" />
              <p class="error" data-for="m_name" aria-live="polite"></p>
            </div>

            <div class="field">
              <label for="m_manaCost">Mana Cost</label>
              <input id="m_manaCost" name="m_manaCost" placeholder="{2}{G}{G}" />
            </div>

            <div class="field">
              <label for="m_cardType">Card Type</label>
              <input id="m_cardType" name="m_cardType" placeholder="Creature, Sorcery, Artifact…" />
            </div>

            <div class="field">
              <label for="m_subtype">Subtype</label>
              <input id="m_subtype" name="m_subtype" placeholder="Elf Druid, Aura…" />
            </div>

            <div class="field">
              <label for="m_setSymbol">Set Symbol</label>
              <input id="m_setSymbol" name="m_setSymbol" />
            </div>

            <div class="field">
              <label for="m_rarity">Rarity</label>
              <input id="m_rarity" name="m_rarity" placeholder="Common/Uncommon/Rare/Mythic…" />
            </div>

            <div class="field">
              <label for="m_raritySymbol">Rarity Symbol</label>
              <select id="m_raritySymbol"></select>
            </div>

            <div class="field">
              <label for="m_powerToughness">Power / Toughness</label>
              <input id="m_powerToughness" name="m_powerToughness" placeholder="e.g., 3/3 (if creature)" />
            </div>

            <div class="field grid-span-2">
              <label for="m_rulesText">Rules Text</label>
              <textarea id="m_rulesText" name="m_rulesText" rows="3"></textarea>
            </div>

            <div class="field grid-span-2">
              <label for="m_flavorText">Flavor Text</label>
              <textarea id="m_flavorText" name="m_flavorText" rows="2" placeholder="If included"></textarea>
            </div>

            <div class="field">
              <label for="m_artist">Artist Credit</label>
              <input id="m_artist" name="m_artist" />
            </div>

            <div class="field">
              <label for="m_collectorNumber">Collector Number</label>
              <input id="m_collectorNumber" name="m_collectorNumber" />
            </div>

            <div class="field">
              <label for="m_setCode">Set Code</label>
              <input id="m_setCode" name="m_setCode" placeholder="e.g., MH3" />
            </div>

            <div class="field">
              <label for="m_language">Language</label>
              <input id="m_language" name="m_language" placeholder="English" />
            </div>

            <div class="field">
              <label for="m_expansionSymbol">Expansion Symbol</label>
              <input id="m_expansionSymbol" name="m_expansionSymbol" />
            </div>

            <div class="field grid-span-2">
              <label for="m_backNotes">Back of the card notes</label>
              <textarea id="m_backNotes" name="m_backNotes" rows="2"
                placeholder="MTG logo / card back design / Deckmaster label (stored as notes)"></textarea>
            </div>
          </div>
        </section>

        <div class="form-actions">
          <button class="btn btn-primary" type="submit">Save Card</button>
          <p class="hint" id="saveHint" aria-live="polite"></p>
        </div>
      </form>
    </section>
  </main>

  <footer class="footer">
    <small>Everything saves locally (localStorage). No accounts needed.</small>
  </footer>

  <script type="module" src="./js/add.mjs"></script>
</body>
</html>
